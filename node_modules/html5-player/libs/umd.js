'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _promise = require('babel-runtime/core-js/promise');

var _promise2 = _interopRequireDefault(_promise);

var _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');

var _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactDom = require('react-dom');

var _reactDom2 = _interopRequireDefault(_reactDom);

var _ = require('./');

var _2 = _interopRequireDefault(_);

require('./style');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

window.React = _react2.default;
window.ReactDOM = _reactDom2.default;

//兼容preact用法
var root = void 0;
/**
 *@param {object} props 播放器配置
 *@param {function} callback 播放器实例化后的回调函数，返回播放器实例
 *                           也可以使用promise获取
 *@return {promise} 播放器实例
 */
function player(props, callback) {
  var id = props.id,
      children = props.children,
      other = (0, _objectWithoutProperties3.default)(props, ['id', 'children']);

  return new _promise2.default(function (resolve) {
    root = _reactDom2.default.render(_react2.default.createElement(
      _2.default,
      (0, _extends3.default)({
        videoCallback: function videoCallback(player) {
          callback && callback(player);
          var remove = player.remove;
          player.remove = function () {
            //如果有定义remove先运行。
            remove && remove();
            root = _reactDom2.default.render(false, document.getElementById(id), root);
          };
          resolve(player);
        }
      }, other),
      children
    ), document.getElementById(id), root);
  });
}

exports.default = player;