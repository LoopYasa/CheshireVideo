{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.prefixStateKey = exports.SagaModel = undefined;\n\nvar _toConsumableArray2 = require(\"babel-runtime/helpers/toConsumableArray\");\n\nvar _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _keys = require(\"babel-runtime/core-js/object/keys\");\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nvar _extends2 = require(\"babel-runtime/helpers/extends\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _flatten = require(\"flatten\");\n\nvar _flatten2 = _interopRequireDefault(_flatten);\n\nvar _document = require(\"global/document\");\n\nvar _document2 = _interopRequireDefault(_document);\n\nvar _window = require(\"global/window\");\n\nvar _window2 = _interopRequireDefault(_window);\n\nvar _invariant = require(\"invariant\");\n\nvar _invariant2 = _interopRequireDefault(_invariant);\n\nvar _isPlainObject = require(\"is-plain-object\");\n\nvar _isPlainObject2 = _interopRequireDefault(_isPlainObject);\n\nvar _lodash = require(\"lodash.isfunction\");\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _redux = require(\"redux\");\n\nvar _effects = require(\"redux-saga/effects\");\n\nvar sagaEffects = _interopRequireWildcard(_effects);\n\nvar _middleware = require(\"redux-saga/lib/internal/middleware\");\n\nvar _middleware2 = _interopRequireDefault(_middleware);\n\nvar _sagaHelpers = require(\"redux-saga/lib/internal/sagaHelpers\");\n\nvar _warning = require(\"warning\");\n\nvar _warning2 = _interopRequireDefault(_warning);\n\nvar _handleActions = require(\"./handleActions\");\n\nvar _handleActions2 = _interopRequireDefault(_handleActions);\n\nvar _plugin = require(\"./plugin\");\n\nvar _plugin2 = _interopRequireDefault(_plugin);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar SEP = \"/\";\n\nvar getPrivateName = function getPrivateName() {\n  return Math.floor(Math.random() * (1 << 30)).toString(16);\n};\n/**\n * 构造每个实例的 private 属性\n */\n\n\nvar installPrivateProperties = {};\n\nvar SagaModel = exports.SagaModel = function () {\n  function SagaModel() {\n    var createOpts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    (0, _classCallCheck3.default)(this, SagaModel);\n    var opts = (0, _extends3.default)({\n      initialState: {},\n      initialReducer: {},\n      initialMiddleware: [],\n      initialModels: [],\n      prefix: \"\"\n    }, createOpts);\n    this.__sagaModelKey = getPrivateName();\n    installPrivateProperties[this.__sagaModelKey] = (0, _extends3.default)({}, opts, {\n      plugin: new _plugin2.default(),\n      models: this.filterModels(opts.initialModels, []),\n      store: null\n    });\n  }\n\n  (0, _createClass3.default)(SagaModel, [{\n    key: \"filterModels\",\n    value: function filterModels(models, baseModels) {\n      var _this = this;\n\n      return models.reduce(function (prev, m) {\n        try {\n          prev.push(_this.checkModel(m, baseModels));\n        } catch (error) {\n          console.error(error);\n        }\n\n        return prev;\n      }, []);\n    }\n    /**\n     * 判断 model 是否合法，同时为所有的 model.reducers 和 model.sagas 打上 namespace 的印记\n     *\n     * @param {any} m model\n     * @param {any} baseModels 已存在的 models\n     * @param hot 是否热加载，如果是热加载则不重新运行对应的 model\n     * @returns\n     */\n\n  }, {\n    key: \"checkModel\",\n    value: function checkModel(m, baseModels, hot) {\n      var privateProps = installPrivateProperties[this.__sagaModelKey]; // Clone model to avoid prefixing namespace multiple times\n\n      var model = (0, _extends3.default)({}, m); // 不允许不对 state 进行初始化\n\n      if (model.state === undefined) {\n        console.error(model.namespace + \" model'state should not be undefined!!\");\n      } // 添加前缀\n\n\n      if (privateProps.prefix) {\n        if (model.namespace !== '@@saga-model-prefix') {\n          model.namespace = \"\" + privateProps.prefix + SEP + m.namespace;\n        }\n      }\n\n      var namespace = model.namespace,\n          reducers = model.reducers,\n          sagas = model.sagas;\n      (0, _invariant2.default)(namespace, \"modelManager.model: namespace should be defined\"); // 非热加载时需要判断是否已存在特定的 namespace\n\n      hot || (0, _invariant2.default)(!baseModels.some(function (model) {\n        return model.namespace === namespace;\n      }), \"modelManager.model: namespace should be unique :\" + model.namespace + \" ,if use webpack please use register with hot parameter\");\n      (0, _invariant2.default)(!model.subscriptions || (0, _isPlainObject2.default)(model.subscriptions) || (0, _lodash2.default)(model.subscriptions), \"modelManager.model: subscriptions should be Object or Function\");\n      (0, _invariant2.default)(!reducers || (0, _isPlainObject2.default)(reducers) || Array.isArray(reducers), \"modelManager.model: reducers should be Object or array\");\n      (0, _invariant2.default)(!Array.isArray(reducers) || (0, _isPlainObject2.default)(reducers[0]) && typeof reducers[1] === \"function\", \"modelManager.model: reducers with array should be modelManager.model({ reducers: [object, function\" + \"] })\");\n      (0, _invariant2.default)(!sagas || (0, _isPlainObject2.default)(sagas), \"modelManager.model: sagas should be Object\");\n\n      function applyNamespace(type) {\n        function getNamespacedReducers(reducers) {\n          return (0, _keys2.default)(reducers).reduce(function (memo, key) {\n            (0, _warning2.default)(key.indexOf(\"\" + namespace + SEP) !== 0, \"modelManager.model: \" + type.slice(0, -1) + \" \" + key + \" should not be prefixed with namespace \" + namespace);\n            memo[\"\" + namespace + SEP + key] = reducers[key];\n            return memo;\n          }, {});\n        } // 给所有的 reducer 和 sagas 加上 namespace 前缀\n\n\n        if (model[type]) {\n          if (type === \"reducers\" && Array.isArray(model[type])) {\n            // reducers hanlers\n            model[type][0] = getNamespacedReducers(model[type][0]);\n          } else {\n            // sagas handlers\n            model[type] = getNamespacedReducers(model[type]);\n          }\n        }\n      }\n\n      applyNamespace(\"reducers\");\n      applyNamespace(\"sagas\");\n      return model;\n    }\n    /**\n     * Register a model.\n     *\n     * @param model\n     */\n\n  }, {\n    key: \"register\",\n    value: function register(model) {\n      var _this2 = this;\n\n      var privateProps = installPrivateProperties[this.__sagaModelKey];\n      var privatePropsModels = privateProps.models;\n\n      if (!Array.isArray(model)) {\n        model = [(0, _extends3.default)({}, model)];\n      } // push when before getStore\n\n\n      model.forEach(function (m) {\n        privatePropsModels.push(_this2.checkModel(m, privatePropsModels, false));\n      });\n      return this;\n    }\n  }, {\n    key: \"setHistory\",\n    value: function setHistory(history) {\n      installPrivateProperties[this.__sagaModelKey].history = history;\n      return this;\n    }\n  }, {\n    key: \"prefix\",\n    value: function prefix() {\n      return installPrivateProperties[this.__sagaModelKey].prefix;\n    }\n  }, {\n    key: \"history\",\n    value: function history() {\n      return installPrivateProperties[this.__sagaModelKey].history;\n    }\n    /**\n     *  dump a model\n     *\n     * @param {any} createReducer\n     * @param {any} reducers\n     * @param {any} _unlisteners\n     * @param {any} namespace\n     * @param {any} m model\n     * @returns\n     * @memberof sagaModelManager\n     */\n\n  }, {\n    key: \"dump\",\n    value: function dump(createReducer, reducers, _unlisteners, namespace) {\n      var privateProps = installPrivateProperties[this.__sagaModelKey];\n      var store = privateProps.store; // Delete reducers\n\n      delete store.asyncReducers[namespace];\n      delete reducers[namespace];\n      store.replaceReducer(createReducer(store.asyncReducers));\n      store.dispatch({\n        type: \"@@saga-model/UPDATE\"\n      });\n      var m = privateProps.models.filter(function (model) {\n        return model.namespace === namespace;\n      }); // Cancel sagas\n\n      m[0] && (0, _keys2.default)(m[0].sagas).forEach(function (key) {\n        store.dispatch({\n          type: key + \"/@@CANCEL_EFFECTS\"\n        });\n      }); // unlisten subscrioptions\n\n      if (_unlisteners[namespace]) {\n        var _unlisteners$namespac = _unlisteners[namespace],\n            unlisteners = _unlisteners$namespac.unlisteners,\n            noneFunctionSubscriptions = _unlisteners$namespac.noneFunctionSubscriptions;\n        (0, _warning2.default)(noneFunctionSubscriptions.length === 0, \"modelManager.unmodel: subscription should return unlistener function, check these subscriptions \" + noneFunctionSubscriptions.join(\", \"));\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          for (var _iterator = (0, _getIterator3.default)(unlisteners), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var unlistener = _step.value;\n            unlistener();\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator.return) {\n              _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n\n        delete _unlisteners[namespace];\n      } // delete model\n\n\n      privateProps.models = privateProps.models.filter(function (model) {\n        return model.namespace !== namespace;\n      });\n      return this;\n    }\n  }, {\n    key: \"plugin\",\n    value: function plugin() {\n      return installPrivateProperties[this.__sagaModelKey].plugin;\n    }\n  }, {\n    key: \"models\",\n    value: function models() {\n      return installPrivateProperties[this.__sagaModelKey].models;\n    }\n    /**\n     * Register an object of hooks on the application.\n     *\n     * @param hooks\n     */\n\n  }, {\n    key: \"use\",\n    value: function use(hooks) {\n      installPrivateProperties[this.__sagaModelKey].plugin.use(hooks);\n\n      return this;\n    }\n    /**\n     *\n     *\n     * @param {any} createReducer\n     * @param {any} onError\n     * @param {any} unlisteners\n     * @param {any} model\n     * @param hot 是否热加载，如果是热加载则不重新运行对应的 model\n     */\n    // inject model dynamically injectModel.bind(this, createReducer,\n    // onErrorWrapper, unlisteners);\n\n  }, {\n    key: \"injectModel\",\n    value: function injectModel(createReducer, onError, unlisteners, model, hot) {\n      var _this3 = this;\n\n      var privateProps = installPrivateProperties[this.__sagaModelKey];\n      var privatePropsModels = privateProps.models;\n      var store = privateProps.store;\n\n      if (!Array.isArray(model)) {\n        model = [model];\n      }\n\n      model.forEach(function (m) {\n        if (Object.prototype.toString.apply(m) === \"[object Function]\") {\n          m = new m();\n        }\n\n        try {\n          m = _this3.checkModel(m, privatePropsModels, hot);\n        } catch (e) {\n          console.error(e);\n          console.error(m.namespace + \" register failed\"); // 不打断系统流程 只是中断当前对应的 model 注册\n\n          return;\n        } // 如果是热替换且已存在对应的 namespace 则重新缓存\n\n\n        var index = -1;\n\n        if (hot) {\n          privatePropsModels.some(function (model, i) {\n            return model.namespace === m.namespace ? (index = i, true) : false;\n          });\n        }\n\n        if (index >= 0) {\n          m.sagas && (0, _keys2.default)(m.sagas).forEach(function (key) {\n            store.dispatch({\n              type: key + \"/@@CANCEL_EFFECTS\"\n            });\n          }); // delete model\n\n          privatePropsModels.splice(index, 1);\n        }\n\n        privatePropsModels.push(m); // reducers\n\n        store.asyncReducers[m.namespace] = _this3.getReducer(m.reducers, m.state, m);\n        store.replaceReducer(createReducer(store.asyncReducers));\n        store.dispatch({\n          type: \"@@saga-model/UPDATE\"\n        }); // sagas\n\n        if (m.sagas) {\n          store.runSaga(_this3.getSaga(m.sagas, m, onError));\n        } // subscriptions\n\n\n        if (m.subscriptions) {\n          unlisteners[m.namespace] = _this3.runSubscriptions(m.subscriptions, m, onError);\n        }\n      });\n    }\n    /**\n     * 将 model.reducers 进行组合成一个统一对外的 reducer\n     * @param {*} reducers model.reducers\n     * @param {*} state model.state 维护的数据表\n     * @param {*} model model\n     */\n\n  }, {\n    key: \"getReducer\",\n    value: function getReducer(reducers, state, model) {\n      // Support reducer enhancer e.g. reducers: [realReducers, enhancer]\n      if (Array.isArray(reducers)) {\n        return reducers[1]((0, _handleActions2.default)(reducers[0], state, model));\n      } else {\n        return (0, _handleActions2.default)(reducers || {}, state, model);\n      }\n    }\n  }, {\n    key: \"runSubscriptions\",\n    value: function runSubscriptions(subs, model, onError) {\n      var _this4 = this;\n\n      var privateProps = installPrivateProperties[this.__sagaModelKey];\n      (0, _invariant2.default)(privateProps.history, \"modelManager.history: cant not be null or undefined\");\n      var unlisteners = [];\n      var noneFunctionSubscriptions = [];\n\n      var run = function run(sub, key) {\n        var unlistener = sub({\n          dispatch: _this4.createDispatch(privateProps.store.dispatch, model),\n          history: privateProps.history\n        }, onError);\n\n        if ((0, _lodash2.default)(unlistener)) {\n          unlisteners.push(unlistener);\n        } else {\n          noneFunctionSubscriptions.push(key);\n        }\n      };\n\n      if ((0, _lodash2.default)(subs)) {\n        run(subs, \"_only\");\n      } else {\n        for (var key in subs) {\n          if (Object.prototype.hasOwnProperty.call(subs, key)) {\n            var sub = subs[key];\n            (0, _invariant2.default)(typeof sub === \"function\", \"modelManager.getStore: subscription should be function\");\n            run(sub, key);\n          }\n        }\n      }\n\n      return {\n        unlisteners: unlisteners,\n        noneFunctionSubscriptions: noneFunctionSubscriptions\n      };\n    }\n    /**\n     * 返回一个生成器，其内部对每个 saga 进行 fork 处理\n     *\n     * @param {any} sagas\n     * @param {any} model\n     * @param {any} onError\n     * @returns\n     */\n\n  }, {\n    key: \"getSaga\",\n    value: function getSaga(sagas, model, onError) {\n      var _self = this;\n\n      return _regenerator2.default.mark(function _callee2() {\n        var _this5 = this;\n\n        var _loop, key;\n\n        return _regenerator2.default.wrap(function _callee2$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _loop = _regenerator2.default.mark(function _loop(key) {\n                  var watcher, task;\n                  return _regenerator2.default.wrap(function _loop$(_context2) {\n                    while (1) {\n                      switch (_context2.prev = _context2.next) {\n                        case 0:\n                          if (!Object.prototype.hasOwnProperty.call(sagas, key)) {\n                            _context2.next = 7;\n                            break;\n                          } // 对每个 saga 进行封装\n\n\n                          watcher = _self.getWatcher(key, sagas[key], model, onError);\n                          _context2.next = 4;\n                          return sagaEffects.fork(watcher);\n\n                        case 4:\n                          task = _context2.sent;\n                          _context2.next = 7;\n                          return sagaEffects.fork(_regenerator2.default.mark(function _callee() {\n                            return _regenerator2.default.wrap(function _callee$(_context) {\n                              while (1) {\n                                switch (_context.prev = _context.next) {\n                                  case 0:\n                                    _context.next = 2;\n                                    return sagaEffects.take(key + \"/@@CANCEL_EFFECTS\");\n\n                                  case 2:\n                                    _context.next = 4;\n                                    return sagaEffects.cancel(task);\n\n                                  case 4:\n                                  case \"end\":\n                                    return _context.stop();\n                                }\n                              }\n                            }, _callee, this);\n                          }));\n\n                        case 7:\n                        case \"end\":\n                          return _context2.stop();\n                      }\n                    }\n                  }, _loop, _this5);\n                });\n                _context3.t0 = _regenerator2.default.keys(sagas);\n\n              case 2:\n                if ((_context3.t1 = _context3.t0()).done) {\n                  _context3.next = 7;\n                  break;\n                }\n\n                key = _context3.t1.value;\n                return _context3.delegateYield(_loop(key), \"t2\", 5);\n\n              case 5:\n                _context3.next = 2;\n                break;\n\n              case 7:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee2, this);\n      });\n    }\n  }, {\n    key: \"createDispatch\",\n    value: function createDispatch(dispatch, model) {\n      var _this6 = this;\n\n      return function (action) {\n        var type = action.type;\n        (0, _invariant2.default)(type, \"dispatch: action should be a plain Object with type\");\n        (0, _warning2.default)(type.indexOf(\"\" + model.namespace + SEP) !== 0, \"dispatch: \" + type + \" should not be prefixed with namespace \" + model.namespace);\n        return dispatch((0, _extends3.default)({}, action, {\n          type: _this6.prefixType(type, model)\n        }));\n      };\n    }\n    /**\n     * 重定向 actionType\n     *\n     * @param {any} type\n     * @param {any} model\n     * @returns\n     */\n\n  }, {\n    key: \"prefixType\",\n    value: function prefixType(type, model) {\n      var prefixedType = \"\" + model.namespace + SEP + type; // 当前 namespace 下的功能 type 已包含 namespace\n\n      if (model.reducers && model.reducers[type] || model.sagas && model.sagas[type]) {\n        return type;\n      } // 当前 namespace 下的功能 type 未包含 namespace\n\n\n      if (model.reducers && model.reducers[prefixedType] || model.sagas && model.sagas[prefixedType]) {\n        return prefixedType;\n      } // 其他 namespace\n\n\n      return this.prefix() ? \"\" + this.prefix() + SEP + type : \"\" + type;\n    }\n    /**\n     * 重置 saga 的 put take API\n     *\n     * @param {any} model\n     * @returns\n     */\n\n  }, {\n    key: \"createEffects\",\n    value: function createEffects(model) {\n      /**\n       * 对 saga 的 put 进行封装，\n       * 默认分发的 action 会补充当前 namespace（包括 prefix）,且必须是当前 model 存在能够被捕获的 saga 或 reducer\n       * 否则需要提供 namespace\n       *\n       * @param {any} action\n       * @param {any} namespace 其他 namespace\n       * @returns\n       */\n      function put(action, namespace) {\n        var type = action.type;\n        (0, _invariant2.default)(type, \"dispatch: action should be a plain Object with type\");\n        (0, _warning2.default)(type.indexOf(\"\" + model.namespace + SEP) !== 0, \"sagas.put: \" + type + \" should not be prefixed with namespace \" + model.namespace);\n        var newType = namespace ? this.prefix() ? \"\" + this.prefix() + SEP + namespace + SEP + type : \"\" + namespace + SEP + type : this.prefixType(type, model);\n        return sagaEffects.put((0, _extends3.default)({}, action, {\n          type: newType\n        }));\n      }\n      /**\n       * 对 saga 的 take 进行封装，默认捕获的 action 会补充当前 namespace,且必须是当前 model 存在能够被捕获的 saga 或 reducer\n       * 否则需要提供 namespace\n       *\n       * @param {any} pattern\n       * @param {any} namespace 其他 namespace\n       * @returns\n       */\n\n\n      function take(pattern, namespace) {\n        // 判断是否捕获当前 namespaces。\n        if (typeof pattern === \"string\") {\n          // 如果是想 take 当前命名空间的话加上 namespace\n          if (namespace) {\n            return sagaEffects.take(\"\" + namespace + SEP + pattern);\n          }\n\n          if (~pattern.indexOf(SEP)) {\n            var fullNamespaces = pattern.split(SEP);\n            var actionType = fullNamespaces[fullNamespaces.length - 1];\n            var namespaces = fullNamespaces.slice(0, fullNamespaces.length - 1);\n            (0, _warning2.default)(namespaces !== model.namespace, \"sagas.take: \" + pattern + \" should not be prefixed with namespace \" + model.namespace);\n          } else {\n            return sagaEffects.take(this.prefixType(pattern, model));\n          }\n        }\n\n        return sagaEffects.take(pattern);\n      }\n\n      return (0, _extends3.default)({}, sagaEffects, {\n        put: put.bind(this),\n        take: take.bind(this)\n      });\n    }\n    /**\n     * 针对每个 saga 进行处理\n     * 最终返回一个生成器\n     *\n     * @param {any} key saga.key 已被打上 namespace 的 tag\n     * @param {any} _saga saga.value\n     * @param {any} model\n     * @param {any} onError\n     * @returns\n     */\n\n  }, {\n    key: \"getWatcher\",\n    value: function getWatcher(key, _saga, model, onError) {\n      var _marked = [sagaWithCatch].map(_regenerator2.default.mark);\n\n      var saga = _saga;\n      var type = \"takeEvery\";\n      var ms = void 0;\n      var privateProps = installPrivateProperties[this.__sagaModelKey]; // 是否指定了 effect 执行的 type\n\n      if (Array.isArray(_saga)) {\n        saga = _saga[0];\n        var opts = _saga[1];\n\n        if (opts && opts.type) {\n          type = opts.type; // 节流\n\n          if (type === \"throttle\") {\n            (0, _invariant2.default)(opts.ms, \"modelManager.getStore: opts.ms should be defined if type is throttle\");\n            ms = opts.ms;\n          }\n        }\n\n        (0, _invariant2.default)([\"watcher\", \"takeEvery\", \"takeLatest\", \"throttle\"].indexOf(type) > -1, \"modelManager.getStore: effect type should be takeEvery, takeLatest, throttle or watcher\");\n      }\n      /**\n       * 封装 saga 对抛出的异常进行处理\n       *\n       * @param {any} action action\n       */\n\n\n      function sagaWithCatch(action) {\n        return _regenerator2.default.wrap(function sagaWithCatch$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.prev = 0;\n                _context4.next = 3;\n                return saga.call(model, action, this.createEffects(model));\n\n              case 3:\n                _context4.next = 8;\n                break;\n\n              case 5:\n                _context4.prev = 5;\n                _context4.t0 = _context4[\"catch\"](0);\n                onError(_context4.t0);\n\n              case 8:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _marked[0], this, [[0, 5]]);\n      } // 让 sagaWithCatch 内部的 this 执行外部的 this\n\n\n      sagaWithCatch = sagaWithCatch.bind(this); // saga hooks onEffect : Array\n\n      var onSaga = privateProps.plugin.get(\"onSaga\"); // 将每个 saga 进行 AOP 封装\n\n      var sagaWithOnSaga = this.applyOnSaga(onSaga, sagaWithCatch, model, key);\n\n      switch (type) {\n        case \"watcher\":\n          return sagaWithCatch;\n\n        case \"takeLatest\":\n          return _regenerator2.default.mark(function _callee3() {\n            return _regenerator2.default.wrap(function _callee3$(_context5) {\n              while (1) {\n                switch (_context5.prev = _context5.next) {\n                  case 0:\n                    _context5.next = 2;\n                    return (0, _sagaHelpers.takeLatestHelper)(key, sagaWithOnSaga);\n\n                  case 2:\n                  case \"end\":\n                    return _context5.stop();\n                }\n              }\n            }, _callee3, this);\n          });\n\n        case \"throttle\":\n          return _regenerator2.default.mark(function _callee4() {\n            return _regenerator2.default.wrap(function _callee4$(_context6) {\n              while (1) {\n                switch (_context6.prev = _context6.next) {\n                  case 0:\n                    _context6.next = 2;\n                    return (0, _sagaHelpers.throttleHelper)(ms, key, sagaWithOnSaga);\n\n                  case 2:\n                  case \"end\":\n                    return _context6.stop();\n                }\n              }\n            }, _callee4, this);\n          });\n\n        default:\n          return _regenerator2.default.mark(function _callee5() {\n            return _regenerator2.default.wrap(function _callee5$(_context7) {\n              while (1) {\n                switch (_context7.prev = _context7.next) {\n                  case 0:\n                    _context7.next = 2;\n                    return (0, _sagaHelpers.takeEveryHelper)(key, sagaWithOnSaga);\n\n                  case 2:\n                  case \"end\":\n                    return _context7.stop();\n                }\n              }\n            }, _callee5, this);\n          });\n      }\n    }\n    /**\n     * 对每一个 saga 进行链式封装\n     *\n     * @param {any} fns onSaga hooks\n     * @param {any} saga sagaWithCatch\n     * @param {any} model\n     * @param {any} key sagaName/actionType\n     * @returns\n     */\n\n  }, {\n    key: \"applyOnSaga\",\n    value: function applyOnSaga(fns, saga, model, key) {\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = (0, _getIterator3.default)(fns), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var fn = _step2.value;\n          saga = fn(saga, sagaEffects, model, key);\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      return saga;\n    }\n  }, {\n    key: \"openReduxDevtool\",\n    value: function openReduxDevtool() {\n      process.env.REDUX_DEVTOOLS_STATUS = \"open\";\n    }\n    /**\n     *\n     * @returns\n     */\n\n  }, {\n    key: \"store\",\n    value: function store() {\n      var privateProps = installPrivateProperties[this.__sagaModelKey];\n      var plugin = privateProps.plugin; // error wrapper 注册默认的 onError handler 默认直接抛出异常\n\n      var onError = plugin.apply(\"onError\", function (err) {\n        throw new Error(err.stack || err);\n      });\n\n      var onErrorWrapper = function onErrorWrapper(err) {\n        if (err) {\n          if (typeof err === \"string\") err = new Error(err); // 若发生异常将控制权交给注册了 onError 的 handler\n\n          onError(err, privateProps.store.dispatch);\n        }\n      }; // internal model for destroy\n\n\n      this.register({\n        namespace: \"@@saga-model\",\n        state: 0,\n        reducers: {\n          UPDATE: function UPDATE(state) {\n            return state + 1;\n          }\n        }\n      }); // 将当前 prefix 放在 state 中方便使用者直接获取\n\n      this.register({\n        namespace: \"@@saga-model-prefix\",\n        state: this.prefix(),\n        reducers: {}\n      }); // get reducers and sagas from model 全局的 sagas\n\n      var sagas = []; // 全局的 reducers 并入外部传入的 reducer\n\n      var reducers = (0, _extends3.default)({}, privateProps.initialReducer); // 遍历所有注册的 model\n\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = (0, _getIterator3.default)(privateProps.models), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var m = _step3.value; // 一个命名空间放一个根级 reducer 每个 model.reducers 都已被打上 namespace 的印记,这里为什么还要区分呢。\n\n          reducers[m.namespace] = this.getReducer(m.reducers, m.state, m); // sagas 不是必须的\n\n          if (m.sagas) sagas.push(this.getSaga(m.sagas, m, onErrorWrapper));\n        } // extra reducers\n\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n\n      var extraReducers = plugin.get(\"extraReducers\");\n      (0, _invariant2.default)((0, _keys2.default)(extraReducers).every(function (key) {\n        return !(key in reducers);\n      }), \"modelManager.getStore: extraReducers is conflict with other reducers\"); // extra enhancers\n\n      var extraEnhancers = plugin.get(\"extraEnhancers\");\n      (0, _invariant2.default)(Array.isArray(extraEnhancers), \"modelManager.getStore: extraEnhancers should be array\"); // create store\n\n      var extraMiddlewares = plugin.get(\"onAction\");\n      var reducerEnhancer = plugin.get(\"onReducer\");\n      var sagaMiddleware = (0, _middleware2.default)();\n      var middlewares = [].concat((0, _toConsumableArray3.default)(privateProps.initialMiddleware), [sagaMiddleware], (0, _toConsumableArray3.default)((0, _flatten2.default)(extraMiddlewares)));\n\n      var devtools = function devtools() {\n        return function (noop) {\n          return noop;\n        };\n      };\n\n      if (_window2.default.__REDUX_DEVTOOLS_EXTENSION__) {\n        var openReduxDevTools = [// 实例化参数\n        privateProps.openReduxDevTools, // openReduxDevtool 方法\n        process.env.REDUX_DEVTOOLS_STATUS === \"open\", // localStroge\n        JSON.parse(localStorage.getItem(\"reduxDevTools\"))].some(function (status) {\n          return status;\n        });\n\n        if (openReduxDevTools) {\n          devtools = _window2.default.__REDUX_DEVTOOLS_EXTENSION__;\n        }\n      }\n\n      var enhancers = [_redux.applyMiddleware.apply(undefined, (0, _toConsumableArray3.default)(middlewares)), devtools()].concat((0, _toConsumableArray3.default)(extraEnhancers));\n      var store = privateProps.store = (0, _redux.createStore)( // eslint-disable-line\n      createReducer(), privateProps.initialState, _redux.compose.apply(undefined, (0, _toConsumableArray3.default)(enhancers)));\n      var _dispatch = store.dispatch;\n\n      store.dispatch = function (action) {\n        // debugger;\n        if (this.prefix()) {\n          _dispatch((0, _extends3.default)({}, action, {\n            type: \"\" + this.prefix() + SEP + action.type\n          }));\n        } else {\n          _dispatch(action);\n        }\n      };\n\n      function createReducer(asyncReducers) {\n        return reducerEnhancer((0, _redux.combineReducers)((0, _extends3.default)({}, reducers, extraReducers, asyncReducers)));\n      } // store change\n\n\n      var listeners = plugin.get(\"onStateChange\");\n      var _iteratorNormalCompletion4 = true;\n      var _didIteratorError4 = false;\n      var _iteratorError4 = undefined;\n\n      try {\n        var _loop2 = function _loop2() {\n          var listener = _step4.value;\n          store.subscribe(function () {\n            listener(store.getState());\n          });\n        };\n\n        for (var _iterator4 = (0, _getIterator3.default)(listeners), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n          _loop2();\n        } // 重点 start saga\n\n      } catch (err) {\n        _didIteratorError4 = true;\n        _iteratorError4 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion4 && _iterator4.return) {\n            _iterator4.return();\n          }\n        } finally {\n          if (_didIteratorError4) {\n            throw _iteratorError4;\n          }\n        }\n      }\n\n      sagas.forEach(sagaMiddleware.run); // run subscriptions\n\n      var unlisteners = {};\n      var _iteratorNormalCompletion5 = true;\n      var _didIteratorError5 = false;\n      var _iteratorError5 = undefined;\n\n      try {\n        for (var _iterator5 = (0, _getIterator3.default)(privateProps.models), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n          var model = _step5.value;\n\n          if (model.subscriptions) {\n            unlisteners[model.namespace] = this.runSubscriptions(model.subscriptions, model, onErrorWrapper);\n          }\n        } // inject model after start\n\n      } catch (err) {\n        _didIteratorError5 = true;\n        _iteratorError5 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion5 && _iterator5.return) {\n            _iterator5.return();\n          }\n        } finally {\n          if (_didIteratorError5) {\n            throw _iteratorError5;\n          }\n        }\n      }\n\n      this.register = this.injectModel.bind(this, createReducer, onErrorWrapper, unlisteners);\n      this.dump = this.dump.bind(this, createReducer, reducers, unlisteners); // extend store\n\n      store.runSaga = sagaMiddleware.run;\n      store.asyncReducers = {};\n      store.register = this.register.bind(this);\n      store.dump = this.dump.bind(this);\n      store.use = this.use.bind(this);\n      store.prefix = this.prefix.bind(this);\n      store.dispatch = store.dispatch.bind(store);\n      return store;\n    }\n  }]);\n  return SagaModel;\n}();\n\nexports.default = new SagaModel();\nvar prefixStateKey = exports.prefixStateKey = \"@@saga-model-prefix\";","map":{"version":3,"sources":["C:/Users/MaGent/Desktop/video/video/node_modules/redux-saga-model/lib/index.js"],"names":["Object","defineProperty","exports","value","prefixStateKey","SagaModel","undefined","_toConsumableArray2","require","_toConsumableArray3","_interopRequireDefault","_regenerator","_regenerator2","_getIterator2","_getIterator3","_keys","_keys2","_extends2","_extends3","_classCallCheck2","_classCallCheck3","_createClass2","_createClass3","_flatten","_flatten2","_document","_document2","_window","_window2","_invariant","_invariant2","_isPlainObject","_isPlainObject2","_lodash","_lodash2","_redux","_effects","sagaEffects","_interopRequireWildcard","_middleware","_middleware2","_sagaHelpers","_warning","_warning2","_handleActions","_handleActions2","_plugin","_plugin2","obj","__esModule","newObj","key","prototype","hasOwnProperty","call","default","SEP","getPrivateName","Math","floor","random","toString","installPrivateProperties","createOpts","arguments","length","opts","initialState","initialReducer","initialMiddleware","initialModels","prefix","__sagaModelKey","plugin","models","filterModels","store","baseModels","_this","reduce","prev","m","push","checkModel","error","console","hot","privateProps","model","state","namespace","reducers","sagas","some","subscriptions","Array","isArray","applyNamespace","type","getNamespacedReducers","memo","indexOf","slice","register","_this2","privatePropsModels","forEach","setHistory","history","dump","createReducer","_unlisteners","asyncReducers","replaceReducer","dispatch","filter","_unlisteners$namespac","unlisteners","noneFunctionSubscriptions","join","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","next","done","unlistener","err","return","use","hooks","injectModel","onError","_this3","apply","e","index","i","splice","getReducer","runSaga","getSaga","runSubscriptions","subs","_this4","run","sub","createDispatch","_self","mark","_callee2","_this5","_loop","wrap","_callee2$","_context3","watcher","task","_loop$","_context2","getWatcher","fork","sent","_callee","_callee$","_context","take","cancel","stop","t0","keys","t1","delegateYield","_this6","action","prefixType","prefixedType","createEffects","put","newType","pattern","fullNamespaces","split","actionType","namespaces","bind","_saga","_marked","sagaWithCatch","map","saga","ms","sagaWithCatch$","_context4","onSaga","get","sagaWithOnSaga","applyOnSaga","_callee3","_callee3$","_context5","takeLatestHelper","_callee4","_callee4$","_context6","throttleHelper","_callee5","_callee5$","_context7","takeEveryHelper","fns","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","fn","openReduxDevtool","process","env","REDUX_DEVTOOLS_STATUS","Error","stack","onErrorWrapper","UPDATE","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","extraReducers","every","extraEnhancers","extraMiddlewares","reducerEnhancer","sagaMiddleware","middlewares","concat","devtools","noop","__REDUX_DEVTOOLS_EXTENSION__","openReduxDevTools","JSON","parse","localStorage","getItem","status","enhancers","applyMiddleware","createStore","compose","_dispatch","combineReducers","listeners","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_loop2","listener","_step4","subscribe","getState","_iterator4","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_iterator5","_step5"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.prefixStateKey = exports.SagaModel = undefined;\n\nvar _toConsumableArray2 = require(\"babel-runtime/helpers/toConsumableArray\");\n\nvar _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _keys = require(\"babel-runtime/core-js/object/keys\");\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nvar _extends2 = require(\"babel-runtime/helpers/extends\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _flatten = require(\"flatten\");\n\nvar _flatten2 = _interopRequireDefault(_flatten);\n\nvar _document = require(\"global/document\");\n\nvar _document2 = _interopRequireDefault(_document);\n\nvar _window = require(\"global/window\");\n\nvar _window2 = _interopRequireDefault(_window);\n\nvar _invariant = require(\"invariant\");\n\nvar _invariant2 = _interopRequireDefault(_invariant);\n\nvar _isPlainObject = require(\"is-plain-object\");\n\nvar _isPlainObject2 = _interopRequireDefault(_isPlainObject);\n\nvar _lodash = require(\"lodash.isfunction\");\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nvar _redux = require(\"redux\");\n\nvar _effects = require(\"redux-saga/effects\");\n\nvar sagaEffects = _interopRequireWildcard(_effects);\n\nvar _middleware = require(\"redux-saga/lib/internal/middleware\");\n\nvar _middleware2 = _interopRequireDefault(_middleware);\n\nvar _sagaHelpers = require(\"redux-saga/lib/internal/sagaHelpers\");\n\nvar _warning = require(\"warning\");\n\nvar _warning2 = _interopRequireDefault(_warning);\n\nvar _handleActions = require(\"./handleActions\");\n\nvar _handleActions2 = _interopRequireDefault(_handleActions);\n\nvar _plugin = require(\"./plugin\");\n\nvar _plugin2 = _interopRequireDefault(_plugin);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar SEP = \"/\";\n\nvar getPrivateName = function getPrivateName() {\n  return Math.floor(Math.random() * (1 << 30)).toString(16);\n};\n\n/**\n * 构造每个实例的 private 属性\n */\nvar installPrivateProperties = {};\n\nvar SagaModel = exports.SagaModel = function () {\n  function SagaModel() {\n    var createOpts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    (0, _classCallCheck3.default)(this, SagaModel);\n\n    var opts = (0, _extends3.default)({\n      initialState: {},\n      initialReducer: {},\n      initialMiddleware: [],\n      initialModels: [],\n      prefix: \"\"\n    }, createOpts);\n\n    this.__sagaModelKey = getPrivateName();\n\n    installPrivateProperties[this.__sagaModelKey] = (0, _extends3.default)({}, opts, {\n      plugin: new _plugin2.default(),\n      models: this.filterModels(opts.initialModels, []),\n      store: null\n    });\n  }\n\n  (0, _createClass3.default)(SagaModel, [{\n    key: \"filterModels\",\n    value: function filterModels(models, baseModels) {\n      var _this = this;\n\n      return models.reduce(function (prev, m) {\n        try {\n          prev.push(_this.checkModel(m, baseModels));\n        } catch (error) {\n          console.error(error);\n        }\n        return prev;\n      }, []);\n    }\n\n    /**\n     * 判断 model 是否合法，同时为所有的 model.reducers 和 model.sagas 打上 namespace 的印记\n     *\n     * @param {any} m model\n     * @param {any} baseModels 已存在的 models\n     * @param hot 是否热加载，如果是热加载则不重新运行对应的 model\n     * @returns\n     */\n\n  }, {\n    key: \"checkModel\",\n    value: function checkModel(m, baseModels, hot) {\n      var privateProps = installPrivateProperties[this.__sagaModelKey];\n\n      // Clone model to avoid prefixing namespace multiple times\n      var model = (0, _extends3.default)({}, m);\n\n      // 不允许不对 state 进行初始化\n      if (model.state === undefined) {\n        console.error(model.namespace + \" model'state should not be undefined!!\");\n      }\n\n      // 添加前缀\n      if (privateProps.prefix) {\n        if (model.namespace !== '@@saga-model-prefix') {\n          model.namespace = \"\" + privateProps.prefix + SEP + m.namespace;\n        }\n      }\n      var namespace = model.namespace,\n          reducers = model.reducers,\n          sagas = model.sagas;\n\n\n      (0, _invariant2.default)(namespace, \"modelManager.model: namespace should be defined\");\n\n      // 非热加载时需要判断是否已存在特定的 namespace\n      hot || (0, _invariant2.default)(!baseModels.some(function (model) {\n        return model.namespace === namespace;\n      }), \"modelManager.model: namespace should be unique :\" + model.namespace + \" ,if use webpack please use register with hot parameter\");\n\n      (0, _invariant2.default)(!model.subscriptions || (0, _isPlainObject2.default)(model.subscriptions) || (0, _lodash2.default)(model.subscriptions), \"modelManager.model: subscriptions should be Object or Function\");\n      (0, _invariant2.default)(!reducers || (0, _isPlainObject2.default)(reducers) || Array.isArray(reducers), \"modelManager.model: reducers should be Object or array\");\n\n      (0, _invariant2.default)(!Array.isArray(reducers) || (0, _isPlainObject2.default)(reducers[0]) && typeof reducers[1] === \"function\", \"modelManager.model: reducers with array should be modelManager.model({ reducers: [object, function\" + \"] })\");\n      (0, _invariant2.default)(!sagas || (0, _isPlainObject2.default)(sagas), \"modelManager.model: sagas should be Object\");\n\n      function applyNamespace(type) {\n        function getNamespacedReducers(reducers) {\n          return (0, _keys2.default)(reducers).reduce(function (memo, key) {\n            (0, _warning2.default)(key.indexOf(\"\" + namespace + SEP) !== 0, \"modelManager.model: \" + type.slice(0, -1) + \" \" + key + \" should not be prefixed with namespace \" + namespace);\n            memo[\"\" + namespace + SEP + key] = reducers[key];\n            return memo;\n          }, {});\n        }\n\n        // 给所有的 reducer 和 sagas 加上 namespace 前缀\n        if (model[type]) {\n          if (type === \"reducers\" && Array.isArray(model[type])) {\n            // reducers hanlers\n            model[type][0] = getNamespacedReducers(model[type][0]);\n          } else {\n            // sagas handlers\n            model[type] = getNamespacedReducers(model[type]);\n          }\n        }\n      }\n\n      applyNamespace(\"reducers\");\n      applyNamespace(\"sagas\");\n\n      return model;\n    }\n\n    /**\n     * Register a model.\n     *\n     * @param model\n     */\n\n  }, {\n    key: \"register\",\n    value: function register(model) {\n      var _this2 = this;\n\n      var privateProps = installPrivateProperties[this.__sagaModelKey];\n\n      var privatePropsModels = privateProps.models;\n      if (!Array.isArray(model)) {\n        model = [(0, _extends3.default)({}, model)];\n      }\n\n      // push when before getStore\n      model.forEach(function (m) {\n        privatePropsModels.push(_this2.checkModel(m, privatePropsModels, false));\n      });\n\n      return this;\n    }\n  }, {\n    key: \"setHistory\",\n    value: function setHistory(history) {\n      installPrivateProperties[this.__sagaModelKey].history = history;\n      return this;\n    }\n  }, {\n    key: \"prefix\",\n    value: function prefix() {\n      return installPrivateProperties[this.__sagaModelKey].prefix;\n    }\n  }, {\n    key: \"history\",\n    value: function history() {\n      return installPrivateProperties[this.__sagaModelKey].history;\n    }\n\n    /**\n     *  dump a model\n     *\n     * @param {any} createReducer\n     * @param {any} reducers\n     * @param {any} _unlisteners\n     * @param {any} namespace\n     * @param {any} m model\n     * @returns\n     * @memberof sagaModelManager\n     */\n\n  }, {\n    key: \"dump\",\n    value: function dump(createReducer, reducers, _unlisteners, namespace) {\n      var privateProps = installPrivateProperties[this.__sagaModelKey];\n\n      var store = privateProps.store;\n\n      // Delete reducers\n      delete store.asyncReducers[namespace];\n      delete reducers[namespace];\n      store.replaceReducer(createReducer(store.asyncReducers));\n      store.dispatch({\n        type: \"@@saga-model/UPDATE\"\n      });\n\n      var m = privateProps.models.filter(function (model) {\n        return model.namespace === namespace;\n      });\n\n      // Cancel sagas\n      m[0] && (0, _keys2.default)(m[0].sagas).forEach(function (key) {\n        store.dispatch({\n          type: key + \"/@@CANCEL_EFFECTS\"\n        });\n      });\n\n      // unlisten subscrioptions\n      if (_unlisteners[namespace]) {\n        var _unlisteners$namespac = _unlisteners[namespace],\n            unlisteners = _unlisteners$namespac.unlisteners,\n            noneFunctionSubscriptions = _unlisteners$namespac.noneFunctionSubscriptions;\n\n        (0, _warning2.default)(noneFunctionSubscriptions.length === 0, \"modelManager.unmodel: subscription should return unlistener function, check these subscriptions \" + noneFunctionSubscriptions.join(\", \"));\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          for (var _iterator = (0, _getIterator3.default)(unlisteners), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var unlistener = _step.value;\n\n            unlistener();\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator.return) {\n              _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n\n        delete _unlisteners[namespace];\n      }\n\n      // delete model\n      privateProps.models = privateProps.models.filter(function (model) {\n        return model.namespace !== namespace;\n      });\n\n      return this;\n    }\n  }, {\n    key: \"plugin\",\n    value: function plugin() {\n      return installPrivateProperties[this.__sagaModelKey].plugin;\n    }\n  }, {\n    key: \"models\",\n    value: function models() {\n      return installPrivateProperties[this.__sagaModelKey].models;\n    }\n\n    /**\n     * Register an object of hooks on the application.\n     *\n     * @param hooks\n     */\n\n  }, {\n    key: \"use\",\n    value: function use(hooks) {\n      installPrivateProperties[this.__sagaModelKey].plugin.use(hooks);\n      return this;\n    }\n\n    /**\n     *\n     *\n     * @param {any} createReducer\n     * @param {any} onError\n     * @param {any} unlisteners\n     * @param {any} model\n     * @param hot 是否热加载，如果是热加载则不重新运行对应的 model\n     */\n    // inject model dynamically injectModel.bind(this, createReducer,\n    // onErrorWrapper, unlisteners);\n\n  }, {\n    key: \"injectModel\",\n    value: function injectModel(createReducer, onError, unlisteners, model, hot) {\n      var _this3 = this;\n\n      var privateProps = installPrivateProperties[this.__sagaModelKey];\n      var privatePropsModels = privateProps.models;\n      var store = privateProps.store;\n\n      if (!Array.isArray(model)) {\n        model = [model];\n      }\n\n      model.forEach(function (m) {\n        if (Object.prototype.toString.apply(m) === \"[object Function]\") {\n          m = new m();\n        }\n        try {\n          m = _this3.checkModel(m, privatePropsModels, hot);\n        } catch (e) {\n          console.error(e);\n          console.error(m.namespace + \" register failed\");\n          // 不打断系统流程 只是中断当前对应的 model 注册\n          return;\n        }\n\n        // 如果是热替换且已存在对应的 namespace 则重新缓存\n        var index = -1;\n        if (hot) {\n          privatePropsModels.some(function (model, i) {\n            return model.namespace === m.namespace ? (index = i, true) : false;\n          });\n        }\n        if (index >= 0) {\n          m.sagas && (0, _keys2.default)(m.sagas).forEach(function (key) {\n            store.dispatch({\n              type: key + \"/@@CANCEL_EFFECTS\"\n            });\n          });\n\n          // delete model\n          privatePropsModels.splice(index, 1);\n        }\n        privatePropsModels.push(m);\n\n        // reducers\n        store.asyncReducers[m.namespace] = _this3.getReducer(m.reducers, m.state, m);\n        store.replaceReducer(createReducer(store.asyncReducers));\n        store.dispatch({\n          type: \"@@saga-model/UPDATE\"\n        });\n        // sagas\n        if (m.sagas) {\n          store.runSaga(_this3.getSaga(m.sagas, m, onError));\n        }\n        // subscriptions\n        if (m.subscriptions) {\n          unlisteners[m.namespace] = _this3.runSubscriptions(m.subscriptions, m, onError);\n        }\n      });\n    }\n\n    /**\n     * 将 model.reducers 进行组合成一个统一对外的 reducer\n     * @param {*} reducers model.reducers\n     * @param {*} state model.state 维护的数据表\n     * @param {*} model model\n     */\n\n  }, {\n    key: \"getReducer\",\n    value: function getReducer(reducers, state, model) {\n      // Support reducer enhancer e.g. reducers: [realReducers, enhancer]\n      if (Array.isArray(reducers)) {\n        return reducers[1]((0, _handleActions2.default)(reducers[0], state, model));\n      } else {\n        return (0, _handleActions2.default)(reducers || {}, state, model);\n      }\n    }\n  }, {\n    key: \"runSubscriptions\",\n    value: function runSubscriptions(subs, model, onError) {\n      var _this4 = this;\n\n      var privateProps = installPrivateProperties[this.__sagaModelKey];\n\n      (0, _invariant2.default)(privateProps.history, \"modelManager.history: cant not be null or undefined\");\n\n      var unlisteners = [];\n      var noneFunctionSubscriptions = [];\n\n      var run = function run(sub, key) {\n        var unlistener = sub({\n          dispatch: _this4.createDispatch(privateProps.store.dispatch, model),\n          history: privateProps.history\n        }, onError);\n        if ((0, _lodash2.default)(unlistener)) {\n          unlisteners.push(unlistener);\n        } else {\n          noneFunctionSubscriptions.push(key);\n        }\n      };\n\n      if ((0, _lodash2.default)(subs)) {\n        run(subs, \"_only\");\n      } else {\n        for (var key in subs) {\n          if (Object.prototype.hasOwnProperty.call(subs, key)) {\n            var sub = subs[key];\n            (0, _invariant2.default)(typeof sub === \"function\", \"modelManager.getStore: subscription should be function\");\n            run(sub, key);\n          }\n        }\n      }\n\n      return {\n        unlisteners: unlisteners,\n        noneFunctionSubscriptions: noneFunctionSubscriptions\n      };\n    }\n\n    /**\n     * 返回一个生成器，其内部对每个 saga 进行 fork 处理\n     *\n     * @param {any} sagas\n     * @param {any} model\n     * @param {any} onError\n     * @returns\n     */\n\n  }, {\n    key: \"getSaga\",\n    value: function getSaga(sagas, model, onError) {\n      var _self = this;\n      return _regenerator2.default.mark(function _callee2() {\n        var _this5 = this;\n\n        var _loop, key;\n\n        return _regenerator2.default.wrap(function _callee2$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _loop = _regenerator2.default.mark(function _loop(key) {\n                  var watcher, task;\n                  return _regenerator2.default.wrap(function _loop$(_context2) {\n                    while (1) {\n                      switch (_context2.prev = _context2.next) {\n                        case 0:\n                          if (!Object.prototype.hasOwnProperty.call(sagas, key)) {\n                            _context2.next = 7;\n                            break;\n                          }\n\n                          // 对每个 saga 进行封装\n                          watcher = _self.getWatcher(key, sagas[key], model, onError);\n                          _context2.next = 4;\n                          return sagaEffects.fork(watcher);\n\n                        case 4:\n                          task = _context2.sent;\n                          _context2.next = 7;\n                          return sagaEffects.fork(_regenerator2.default.mark(function _callee() {\n                            return _regenerator2.default.wrap(function _callee$(_context) {\n                              while (1) {\n                                switch (_context.prev = _context.next) {\n                                  case 0:\n                                    _context.next = 2;\n                                    return sagaEffects.take(key + \"/@@CANCEL_EFFECTS\");\n\n                                  case 2:\n                                    _context.next = 4;\n                                    return sagaEffects.cancel(task);\n\n                                  case 4:\n                                  case \"end\":\n                                    return _context.stop();\n                                }\n                              }\n                            }, _callee, this);\n                          }));\n\n                        case 7:\n                        case \"end\":\n                          return _context2.stop();\n                      }\n                    }\n                  }, _loop, _this5);\n                });\n                _context3.t0 = _regenerator2.default.keys(sagas);\n\n              case 2:\n                if ((_context3.t1 = _context3.t0()).done) {\n                  _context3.next = 7;\n                  break;\n                }\n\n                key = _context3.t1.value;\n                return _context3.delegateYield(_loop(key), \"t2\", 5);\n\n              case 5:\n                _context3.next = 2;\n                break;\n\n              case 7:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee2, this);\n      });\n    }\n  }, {\n    key: \"createDispatch\",\n    value: function createDispatch(dispatch, model) {\n      var _this6 = this;\n\n      return function (action) {\n        var type = action.type;\n\n        (0, _invariant2.default)(type, \"dispatch: action should be a plain Object with type\");\n        (0, _warning2.default)(type.indexOf(\"\" + model.namespace + SEP) !== 0, \"dispatch: \" + type + \" should not be prefixed with namespace \" + model.namespace);\n        return dispatch((0, _extends3.default)({}, action, {\n          type: _this6.prefixType(type, model)\n        }));\n      };\n    }\n\n    /**\n     * 重定向 actionType\n     *\n     * @param {any} type\n     * @param {any} model\n     * @returns\n     */\n\n  }, {\n    key: \"prefixType\",\n    value: function prefixType(type, model) {\n      var prefixedType = \"\" + model.namespace + SEP + type;\n      // 当前 namespace 下的功能 type 已包含 namespace\n      if (model.reducers && model.reducers[type] || model.sagas && model.sagas[type]) {\n        return type;\n      }\n      // 当前 namespace 下的功能 type 未包含 namespace\n      if (model.reducers && model.reducers[prefixedType] || model.sagas && model.sagas[prefixedType]) {\n        return prefixedType;\n      }\n      // 其他 namespace\n      return this.prefix() ? \"\" + this.prefix() + SEP + type : \"\" + type;\n    }\n\n    /**\n     * 重置 saga 的 put take API\n     *\n     * @param {any} model\n     * @returns\n     */\n\n  }, {\n    key: \"createEffects\",\n    value: function createEffects(model) {\n      /**\n       * 对 saga 的 put 进行封装，\n       * 默认分发的 action 会补充当前 namespace（包括 prefix）,且必须是当前 model 存在能够被捕获的 saga 或 reducer\n       * 否则需要提供 namespace\n       *\n       * @param {any} action\n       * @param {any} namespace 其他 namespace\n       * @returns\n       */\n      function put(action, namespace) {\n        var type = action.type;\n\n        (0, _invariant2.default)(type, \"dispatch: action should be a plain Object with type\");\n        (0, _warning2.default)(type.indexOf(\"\" + model.namespace + SEP) !== 0, \"sagas.put: \" + type + \" should not be prefixed with namespace \" + model.namespace);\n        var newType = namespace ? this.prefix() ? \"\" + this.prefix() + SEP + namespace + SEP + type : \"\" + namespace + SEP + type : this.prefixType(type, model);\n\n        return sagaEffects.put((0, _extends3.default)({}, action, {\n          type: newType\n        }));\n      }\n\n      /**\n       * 对 saga 的 take 进行封装，默认捕获的 action 会补充当前 namespace,且必须是当前 model 存在能够被捕获的 saga 或 reducer\n       * 否则需要提供 namespace\n       *\n       * @param {any} pattern\n       * @param {any} namespace 其他 namespace\n       * @returns\n       */\n      function take(pattern, namespace) {\n        // 判断是否捕获当前 namespaces。\n        if (typeof pattern === \"string\") {\n          // 如果是想 take 当前命名空间的话加上 namespace\n\n          if (namespace) {\n            return sagaEffects.take(\"\" + namespace + SEP + pattern);\n          }\n\n          if (~pattern.indexOf(SEP)) {\n            var fullNamespaces = pattern.split(SEP);\n            var actionType = fullNamespaces[fullNamespaces.length - 1];\n            var namespaces = fullNamespaces.slice(0, fullNamespaces.length - 1);\n            (0, _warning2.default)(namespaces !== model.namespace, \"sagas.take: \" + pattern + \" should not be prefixed with namespace \" + model.namespace);\n          } else {\n            return sagaEffects.take(this.prefixType(pattern, model));\n          }\n        }\n        return sagaEffects.take(pattern);\n      }\n\n      return (0, _extends3.default)({}, sagaEffects, {\n        put: put.bind(this),\n        take: take.bind(this)\n      });\n    }\n\n    /**\n     * 针对每个 saga 进行处理\n     * 最终返回一个生成器\n     *\n     * @param {any} key saga.key 已被打上 namespace 的 tag\n     * @param {any} _saga saga.value\n     * @param {any} model\n     * @param {any} onError\n     * @returns\n     */\n\n  }, {\n    key: \"getWatcher\",\n    value: function getWatcher(key, _saga, model, onError) {\n      var _marked = [sagaWithCatch].map(_regenerator2.default.mark);\n\n      var saga = _saga;\n      var type = \"takeEvery\";\n      var ms = void 0;\n      var privateProps = installPrivateProperties[this.__sagaModelKey];\n\n      // 是否指定了 effect 执行的 type\n      if (Array.isArray(_saga)) {\n        saga = _saga[0];\n        var opts = _saga[1];\n        if (opts && opts.type) {\n          type = opts.type;\n          // 节流\n          if (type === \"throttle\") {\n            (0, _invariant2.default)(opts.ms, \"modelManager.getStore: opts.ms should be defined if type is throttle\");\n            ms = opts.ms;\n          }\n        }\n        (0, _invariant2.default)([\"watcher\", \"takeEvery\", \"takeLatest\", \"throttle\"].indexOf(type) > -1, \"modelManager.getStore: effect type should be takeEvery, takeLatest, throttle or watcher\");\n      }\n\n      /**\n       * 封装 saga 对抛出的异常进行处理\n       *\n       * @param {any} action action\n       */\n      function sagaWithCatch(action) {\n        return _regenerator2.default.wrap(function sagaWithCatch$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.prev = 0;\n                _context4.next = 3;\n                return saga.call(model, action, this.createEffects(model));\n\n              case 3:\n                _context4.next = 8;\n                break;\n\n              case 5:\n                _context4.prev = 5;\n                _context4.t0 = _context4[\"catch\"](0);\n\n                onError(_context4.t0);\n\n              case 8:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _marked[0], this, [[0, 5]]);\n      }\n\n      // 让 sagaWithCatch 内部的 this 执行外部的 this\n      sagaWithCatch = sagaWithCatch.bind(this);\n\n      // saga hooks onEffect : Array\n      var onSaga = privateProps.plugin.get(\"onSaga\");\n      // 将每个 saga 进行 AOP 封装\n      var sagaWithOnSaga = this.applyOnSaga(onSaga, sagaWithCatch, model, key);\n\n      switch (type) {\n        case \"watcher\":\n          return sagaWithCatch;\n        case \"takeLatest\":\n          return _regenerator2.default.mark(function _callee3() {\n            return _regenerator2.default.wrap(function _callee3$(_context5) {\n              while (1) {\n                switch (_context5.prev = _context5.next) {\n                  case 0:\n                    _context5.next = 2;\n                    return (0, _sagaHelpers.takeLatestHelper)(key, sagaWithOnSaga);\n\n                  case 2:\n                  case \"end\":\n                    return _context5.stop();\n                }\n              }\n            }, _callee3, this);\n          });\n        case \"throttle\":\n          return _regenerator2.default.mark(function _callee4() {\n            return _regenerator2.default.wrap(function _callee4$(_context6) {\n              while (1) {\n                switch (_context6.prev = _context6.next) {\n                  case 0:\n                    _context6.next = 2;\n                    return (0, _sagaHelpers.throttleHelper)(ms, key, sagaWithOnSaga);\n\n                  case 2:\n                  case \"end\":\n                    return _context6.stop();\n                }\n              }\n            }, _callee4, this);\n          });\n        default:\n          return _regenerator2.default.mark(function _callee5() {\n            return _regenerator2.default.wrap(function _callee5$(_context7) {\n              while (1) {\n                switch (_context7.prev = _context7.next) {\n                  case 0:\n                    _context7.next = 2;\n                    return (0, _sagaHelpers.takeEveryHelper)(key, sagaWithOnSaga);\n\n                  case 2:\n                  case \"end\":\n                    return _context7.stop();\n                }\n              }\n            }, _callee5, this);\n          });\n      }\n    }\n\n    /**\n     * 对每一个 saga 进行链式封装\n     *\n     * @param {any} fns onSaga hooks\n     * @param {any} saga sagaWithCatch\n     * @param {any} model\n     * @param {any} key sagaName/actionType\n     * @returns\n     */\n\n  }, {\n    key: \"applyOnSaga\",\n    value: function applyOnSaga(fns, saga, model, key) {\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = (0, _getIterator3.default)(fns), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var fn = _step2.value;\n\n          saga = fn(saga, sagaEffects, model, key);\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      return saga;\n    }\n  }, {\n    key: \"openReduxDevtool\",\n    value: function openReduxDevtool() {\n      process.env.REDUX_DEVTOOLS_STATUS = \"open\";\n    }\n\n    /**\n     *\n     * @returns\n     */\n\n  }, {\n    key: \"store\",\n    value: function store() {\n      var privateProps = installPrivateProperties[this.__sagaModelKey];\n      var plugin = privateProps.plugin;\n\n      // error wrapper 注册默认的 onError handler 默认直接抛出异常\n      var onError = plugin.apply(\"onError\", function (err) {\n        throw new Error(err.stack || err);\n      });\n\n      var onErrorWrapper = function onErrorWrapper(err) {\n        if (err) {\n          if (typeof err === \"string\") err = new Error(err);\n\n          // 若发生异常将控制权交给注册了 onError 的 handler\n          onError(err, privateProps.store.dispatch);\n        }\n      };\n\n      // internal model for destroy\n      this.register({\n        namespace: \"@@saga-model\",\n        state: 0,\n        reducers: {\n          UPDATE: function UPDATE(state) {\n            return state + 1;\n          }\n        }\n      });\n      // 将当前 prefix 放在 state 中方便使用者直接获取\n      this.register({\n        namespace: \"@@saga-model-prefix\",\n        state: this.prefix(),\n        reducers: {}\n      });\n\n      // get reducers and sagas from model 全局的 sagas\n      var sagas = [];\n      // 全局的 reducers 并入外部传入的 reducer\n      var reducers = (0, _extends3.default)({}, privateProps.initialReducer);\n\n      // 遍历所有注册的 model\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = (0, _getIterator3.default)(privateProps.models), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var m = _step3.value;\n\n          // 一个命名空间放一个根级 reducer 每个 model.reducers 都已被打上 namespace 的印记,这里为什么还要区分呢。\n          reducers[m.namespace] = this.getReducer(m.reducers, m.state, m);\n          // sagas 不是必须的\n          if (m.sagas) sagas.push(this.getSaga(m.sagas, m, onErrorWrapper));\n        }\n\n        // extra reducers\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n\n      var extraReducers = plugin.get(\"extraReducers\");\n      (0, _invariant2.default)((0, _keys2.default)(extraReducers).every(function (key) {\n        return !(key in reducers);\n      }), \"modelManager.getStore: extraReducers is conflict with other reducers\");\n\n      // extra enhancers\n      var extraEnhancers = plugin.get(\"extraEnhancers\");\n      (0, _invariant2.default)(Array.isArray(extraEnhancers), \"modelManager.getStore: extraEnhancers should be array\");\n\n      // create store\n      var extraMiddlewares = plugin.get(\"onAction\");\n      var reducerEnhancer = plugin.get(\"onReducer\");\n      var sagaMiddleware = (0, _middleware2.default)();\n      var middlewares = [].concat((0, _toConsumableArray3.default)(privateProps.initialMiddleware), [sagaMiddleware], (0, _toConsumableArray3.default)((0, _flatten2.default)(extraMiddlewares)));\n\n      var devtools = function devtools() {\n        return function (noop) {\n          return noop;\n        };\n      };\n\n      if (_window2.default.__REDUX_DEVTOOLS_EXTENSION__) {\n        var openReduxDevTools = [\n        // 实例化参数\n        privateProps.openReduxDevTools,\n        // openReduxDevtool 方法\n        process.env.REDUX_DEVTOOLS_STATUS === \"open\",\n        // localStroge\n        JSON.parse(localStorage.getItem(\"reduxDevTools\"))].some(function (status) {\n          return status;\n        });\n\n        if (openReduxDevTools) {\n          devtools = _window2.default.__REDUX_DEVTOOLS_EXTENSION__;\n        }\n      }\n\n      var enhancers = [_redux.applyMiddleware.apply(undefined, (0, _toConsumableArray3.default)(middlewares)), devtools()].concat((0, _toConsumableArray3.default)(extraEnhancers));\n      var store = privateProps.store = (0, _redux.createStore)(\n      // eslint-disable-line\n      createReducer(), privateProps.initialState, _redux.compose.apply(undefined, (0, _toConsumableArray3.default)(enhancers)));\n\n      var _dispatch = store.dispatch;\n\n      store.dispatch = function (action) {\n        // debugger;\n        if (this.prefix()) {\n          _dispatch((0, _extends3.default)({}, action, {\n            type: \"\" + this.prefix() + SEP + action.type\n          }));\n        } else {\n          _dispatch(action);\n        }\n      };\n\n      function createReducer(asyncReducers) {\n        return reducerEnhancer((0, _redux.combineReducers)((0, _extends3.default)({}, reducers, extraReducers, asyncReducers)));\n      }\n\n      // store change\n      var listeners = plugin.get(\"onStateChange\");\n      var _iteratorNormalCompletion4 = true;\n      var _didIteratorError4 = false;\n      var _iteratorError4 = undefined;\n\n      try {\n        var _loop2 = function _loop2() {\n          var listener = _step4.value;\n\n          store.subscribe(function () {\n            listener(store.getState());\n          });\n        };\n\n        for (var _iterator4 = (0, _getIterator3.default)(listeners), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n          _loop2();\n        }\n\n        // 重点 start saga\n      } catch (err) {\n        _didIteratorError4 = true;\n        _iteratorError4 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion4 && _iterator4.return) {\n            _iterator4.return();\n          }\n        } finally {\n          if (_didIteratorError4) {\n            throw _iteratorError4;\n          }\n        }\n      }\n\n      sagas.forEach(sagaMiddleware.run);\n\n      // run subscriptions\n      var unlisteners = {};\n      var _iteratorNormalCompletion5 = true;\n      var _didIteratorError5 = false;\n      var _iteratorError5 = undefined;\n\n      try {\n        for (var _iterator5 = (0, _getIterator3.default)(privateProps.models), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n          var model = _step5.value;\n\n          if (model.subscriptions) {\n            unlisteners[model.namespace] = this.runSubscriptions(model.subscriptions, model, onErrorWrapper);\n          }\n        }\n\n        // inject model after start\n      } catch (err) {\n        _didIteratorError5 = true;\n        _iteratorError5 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion5 && _iterator5.return) {\n            _iterator5.return();\n          }\n        } finally {\n          if (_didIteratorError5) {\n            throw _iteratorError5;\n          }\n        }\n      }\n\n      this.register = this.injectModel.bind(this, createReducer, onErrorWrapper, unlisteners);\n      this.dump = this.dump.bind(this, createReducer, reducers, unlisteners);\n\n      // extend store\n      store.runSaga = sagaMiddleware.run;\n      store.asyncReducers = {};\n      store.register = this.register.bind(this);\n      store.dump = this.dump.bind(this);\n      store.use = this.use.bind(this);\n      store.prefix = this.prefix.bind(this);\n      store.dispatch = store.dispatch.bind(store);\n\n      return store;\n    }\n  }]);\n  return SagaModel;\n}();\n\nexports.default = new SagaModel();\nvar prefixStateKey = exports.prefixStateKey = \"@@saga-model-prefix\";"]},"metadata":{},"sourceType":"script"}