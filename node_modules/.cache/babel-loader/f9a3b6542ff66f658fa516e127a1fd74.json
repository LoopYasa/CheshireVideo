{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.namespace = undefined;\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nexports.default = function () {\n  //存放subtitle的cues\n  var cuesList = [];\n  return {\n    namespace: namespace,\n    state: {\n      subtitleId: -1,\n      subtitleList: [],\n      subtitleCues: null,\n      thumbnails: null\n    },\n    reducers: {\n      trackReducer: _util.standardReducer,\n      clear: function clear(state, _ref) {\n        var payload = _ref.payload;\n        cancel && cancel();\n        return this.state;\n      }\n    },\n    sagas: {\n      subtitleListSaga: /*#__PURE__*/_regenerator2.default.mark(function subtitleListSaga(_ref2, _ref3) {\n        var _ref2$payload = _ref2.payload,\n            subtitleList = _ref2$payload.subtitleList,\n            subtitleId = _ref2$payload.subtitleId;\n        var put = _ref3.put,\n            call = _ref3.call;\n        var data;\n        return _regenerator2.default.wrap(function subtitleListSaga$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                data = {\n                  subtitleId: subtitleId\n                };\n\n                if (subtitleList) {\n                  data.subtitleList = subtitleList;\n                }\n\n                _context.next = 4;\n                return put({\n                  type: 'trackReducer',\n                  payload: data\n                });\n\n              case 4:\n              case 'end':\n                return _context.stop();\n            }\n          }\n        }, subtitleListSaga, this);\n      }),\n      hlsSubtitleCuesSaga: /*#__PURE__*/_regenerator2.default.mark(function hlsSubtitleCuesSaga(_ref4, _ref5) {\n        var payload = _ref4.payload;\n        var put = _ref5.put,\n            call = _ref5.call;\n        return _regenerator2.default.wrap(function hlsSubtitleCuesSaga$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return put({\n                  type: 'trackReducer',\n                  payload: {\n                    subtitleCues: payload\n                  }\n                });\n\n              case 2:\n              case 'end':\n                return _context2.stop();\n            }\n          }\n        }, hlsSubtitleCuesSaga, this);\n      }),\n      subtitleCuesSaga: /*#__PURE__*/_regenerator2.default.mark(function subtitleCuesSaga(_ref6, _ref7) {\n        var payload = _ref6.payload;\n        var put = _ref7.put,\n            call = _ref7.call;\n        var data, vtt;\n        return _regenerator2.default.wrap(function subtitleCuesSaga$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                data = void 0;\n\n                if (!(payload.subtitleId === -1)) {\n                  _context3.next = 5;\n                  break;\n                } //关闭字幕\n\n\n                data = [];\n                _context3.next = 15;\n                break;\n\n              case 5:\n                if (cuesList[payload.subtitleId]) {\n                  _context3.next = 14;\n                  break;\n                }\n\n                _context3.next = 8;\n                return call(fetchTrack, payload.file);\n\n              case 8:\n                vtt = _context3.sent;\n\n                if (vtt) {\n                  _context3.next = 11;\n                  break;\n                }\n\n                return _context3.abrupt('return');\n\n              case 11:\n                data = (0, _srt2.default)(vtt);\n                _context3.next = 15;\n                break;\n\n              case 14:\n                data = cuesList[payload.subtitleId];\n\n              case 15:\n                if (data) {\n                  cuesList[payload.subtitleId] = data;\n                }\n\n                _context3.next = 18;\n                return put({\n                  type: 'trackReducer',\n                  payload: {\n                    subtitleCues: data\n                  }\n                });\n\n              case 18:\n              case 'end':\n                return _context3.stop();\n            }\n          }\n        }, subtitleCuesSaga, this);\n      }),\n      thumbnailSaga: /*#__PURE__*/_regenerator2.default.mark(function thumbnailSaga(_ref8, _ref9) {\n        var payload = _ref8.payload;\n        var put = _ref9.put,\n            call = _ref9.call;\n        var vtt, data;\n        return _regenerator2.default.wrap(function thumbnailSaga$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return call(fetchTrack, payload.file);\n\n              case 2:\n                vtt = _context4.sent;\n\n                if (vtt) {\n                  _context4.next = 5;\n                  break;\n                }\n\n                return _context4.abrupt('return');\n\n              case 5:\n                data = (0, _srt2.default)(vtt);\n                data.forEach(function (v) {\n                  var url = payload.file.split('?')[0].split('/').slice(0, -1).join('/');\n\n                  if (~v.text.indexOf('://')) {\n                    url = v.text;\n                  } else {\n                    url += '/' + v.text;\n                  }\n\n                  if (~url.indexOf('#xywh')) {\n                    //一张图片中有多张缩略图\n                    var matched = /(.+)#xywh=(\\d+),(\\d+),(\\d+),(\\d+)/.exec(url);\n                    v.thumbnail = matched;\n                  } else {\n                    //单张图片直接做缩略图\n                    v.thumbnail = url;\n                  }\n                });\n                _context4.next = 9;\n                return put({\n                  type: 'trackReducer',\n                  payload: {\n                    thumbnails: data\n                  }\n                });\n\n              case 9:\n              case 'end':\n                return _context4.stop();\n            }\n          }\n        }, thumbnailSaga, this);\n      })\n    }\n  };\n};\n\nvar _util = require('../utils/util');\n\nvar _fetch = require('../utils/fetch');\n\nvar _fetch2 = _interopRequireDefault(_fetch);\n\nvar _srt = require('../utils/srt');\n\nvar _srt2 = _interopRequireDefault(_srt);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n} //请求取消函数\n\n\nvar cancel = void 0;\n\nfunction fetchTrack(url, params) {\n  var cancelSource = _fetch2.default.getCancelSource();\n\n  cancel = cancelSource.cancel;\n  return _fetch2.default.get(url, {\n    responseType: 'text',\n    params: params,\n    cancelToken: cancelSource.token\n  }).catch(function (error) {\n    return false;\n  });\n}\n\nvar namespace = exports.namespace = 'track';","map":{"version":3,"sources":["C:/Users/MaGent/Desktop/video/video/node_modules/html5-player/libs/model/track.js"],"names":["Object","defineProperty","exports","value","namespace","undefined","_regenerator","require","_regenerator2","_interopRequireDefault","default","cuesList","state","subtitleId","subtitleList","subtitleCues","thumbnails","reducers","trackReducer","_util","standardReducer","clear","_ref","payload","cancel","sagas","subtitleListSaga","mark","_ref2","_ref3","_ref2$payload","put","call","data","wrap","subtitleListSaga$","_context","prev","next","type","stop","hlsSubtitleCuesSaga","_ref4","_ref5","hlsSubtitleCuesSaga$","_context2","subtitleCuesSaga","_ref6","_ref7","vtt","subtitleCuesSaga$","_context3","fetchTrack","file","sent","abrupt","_srt2","thumbnailSaga","_ref8","_ref9","thumbnailSaga$","_context4","forEach","v","url","split","slice","join","text","indexOf","matched","exec","thumbnail","_fetch","_fetch2","_srt","obj","__esModule","params","cancelSource","getCancelSource","get","responseType","cancelToken","token","catch","error"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.namespace = undefined;\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nexports.default = function () {\n  //存放subtitle的cues\n  var cuesList = [];\n  return {\n    namespace: namespace,\n    state: {\n      subtitleId: -1,\n      subtitleList: [],\n      subtitleCues: null,\n      thumbnails: null\n    },\n    reducers: {\n      trackReducer: _util.standardReducer,\n      clear: function clear(state, _ref) {\n        var payload = _ref.payload;\n\n        cancel && cancel();\n        return this.state;\n      }\n    },\n    sagas: {\n      subtitleListSaga: /*#__PURE__*/_regenerator2.default.mark(function subtitleListSaga(_ref2, _ref3) {\n        var _ref2$payload = _ref2.payload,\n            subtitleList = _ref2$payload.subtitleList,\n            subtitleId = _ref2$payload.subtitleId;\n        var put = _ref3.put,\n            call = _ref3.call;\n        var data;\n        return _regenerator2.default.wrap(function subtitleListSaga$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                data = {\n                  subtitleId: subtitleId\n                };\n\n                if (subtitleList) {\n                  data.subtitleList = subtitleList;\n                }\n                _context.next = 4;\n                return put({\n                  type: 'trackReducer',\n                  payload: data\n                });\n\n              case 4:\n              case 'end':\n                return _context.stop();\n            }\n          }\n        }, subtitleListSaga, this);\n      }),\n      hlsSubtitleCuesSaga: /*#__PURE__*/_regenerator2.default.mark(function hlsSubtitleCuesSaga(_ref4, _ref5) {\n        var payload = _ref4.payload;\n        var put = _ref5.put,\n            call = _ref5.call;\n        return _regenerator2.default.wrap(function hlsSubtitleCuesSaga$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return put({\n                  type: 'trackReducer',\n                  payload: {\n                    subtitleCues: payload\n                  }\n                });\n\n              case 2:\n              case 'end':\n                return _context2.stop();\n            }\n          }\n        }, hlsSubtitleCuesSaga, this);\n      }),\n      subtitleCuesSaga: /*#__PURE__*/_regenerator2.default.mark(function subtitleCuesSaga(_ref6, _ref7) {\n        var payload = _ref6.payload;\n        var put = _ref7.put,\n            call = _ref7.call;\n        var data, vtt;\n        return _regenerator2.default.wrap(function subtitleCuesSaga$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                data = void 0;\n\n                if (!(payload.subtitleId === -1)) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                //关闭字幕\n                data = [];\n                _context3.next = 15;\n                break;\n\n              case 5:\n                if (cuesList[payload.subtitleId]) {\n                  _context3.next = 14;\n                  break;\n                }\n\n                _context3.next = 8;\n                return call(fetchTrack, payload.file);\n\n              case 8:\n                vtt = _context3.sent;\n\n                if (vtt) {\n                  _context3.next = 11;\n                  break;\n                }\n\n                return _context3.abrupt('return');\n\n              case 11:\n                data = (0, _srt2.default)(vtt);\n                _context3.next = 15;\n                break;\n\n              case 14:\n                data = cuesList[payload.subtitleId];\n\n              case 15:\n                if (data) {\n                  cuesList[payload.subtitleId] = data;\n                }\n                _context3.next = 18;\n                return put({\n                  type: 'trackReducer',\n                  payload: {\n                    subtitleCues: data\n                  }\n                });\n\n              case 18:\n              case 'end':\n                return _context3.stop();\n            }\n          }\n        }, subtitleCuesSaga, this);\n      }),\n      thumbnailSaga: /*#__PURE__*/_regenerator2.default.mark(function thumbnailSaga(_ref8, _ref9) {\n        var payload = _ref8.payload;\n        var put = _ref9.put,\n            call = _ref9.call;\n        var vtt, data;\n        return _regenerator2.default.wrap(function thumbnailSaga$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return call(fetchTrack, payload.file);\n\n              case 2:\n                vtt = _context4.sent;\n\n                if (vtt) {\n                  _context4.next = 5;\n                  break;\n                }\n\n                return _context4.abrupt('return');\n\n              case 5:\n                data = (0, _srt2.default)(vtt);\n\n                data.forEach(function (v) {\n                  var url = payload.file.split('?')[0].split('/').slice(0, -1).join('/');\n                  if (~v.text.indexOf('://')) {\n                    url = v.text;\n                  } else {\n                    url += '/' + v.text;\n                  }\n                  if (~url.indexOf('#xywh')) {\n                    //一张图片中有多张缩略图\n                    var matched = /(.+)#xywh=(\\d+),(\\d+),(\\d+),(\\d+)/.exec(url);\n                    v.thumbnail = matched;\n                  } else {\n                    //单张图片直接做缩略图\n                    v.thumbnail = url;\n                  }\n                });\n                _context4.next = 9;\n                return put({\n                  type: 'trackReducer',\n                  payload: {\n                    thumbnails: data\n                  }\n                });\n\n              case 9:\n              case 'end':\n                return _context4.stop();\n            }\n          }\n        }, thumbnailSaga, this);\n      })\n    }\n  };\n};\n\nvar _util = require('../utils/util');\n\nvar _fetch = require('../utils/fetch');\n\nvar _fetch2 = _interopRequireDefault(_fetch);\n\nvar _srt = require('../utils/srt');\n\nvar _srt2 = _interopRequireDefault(_srt);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//请求取消函数\nvar cancel = void 0;\n\nfunction fetchTrack(url, params) {\n  var cancelSource = _fetch2.default.getCancelSource();\n  cancel = cancelSource.cancel;\n  return _fetch2.default.get(url, { responseType: 'text', params: params, cancelToken: cancelSource.token }).catch(function (error) {\n    return false;\n  });\n}\n\nvar namespace = exports.namespace = 'track';"]},"metadata":{},"sourceType":"script"}