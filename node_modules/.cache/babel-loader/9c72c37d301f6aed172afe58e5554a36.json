{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Fetch = undefined;\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nexports.joinUrlParams = joinUrlParams;\n\nexports.default = function (config, statusCallback, catchErrorCallback, setHeaders) {\n  var ieCache = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;\n  config = (0, _extends3.default)({}, _config2.default, config);\n  var fetch = new Fetch(config, statusCallback, catchErrorCallback);\n  fetch.setHeaders(setHeaders); //这里向外提供get、delete等直接使用的方式。\n\n  var methods = ['get', 'delete', 'head', 'options', 'post', 'put', 'patch'];\n  methods.forEach(function (v) {\n    switch (v) {\n      case 'post':\n      case 'put':\n      case 'patch':\n        fetch[v] = function (url, data, config) {\n          return fetch.request((0, _extends3.default)({\n            method: v,\n            data: data,\n            url: url\n          }, config));\n        };\n\n        break;\n\n      default:\n        fetch[v] = function (url, config) {\n          return fetch.request((0, _extends3.default)({\n            method: v,\n            url: url\n          }, config));\n        };\n\n    }\n  });\n  return fetch;\n};\n\nvar _axios = require('axios');\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nvar _config = require('./config.js');\n\nvar _config2 = _interopRequireDefault(_config);\n\nvar _isObject = require('lodash/isObject');\n\nvar _isObject2 = _interopRequireDefault(_isObject);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n/**\n * 处理axios的异常问题，只要能接收到接口数据，都当做是成功请求。\n * 中途出错，无法返回的数据才传递可捕获的异常。\n * @param {error} error\n * @param {object} statusCallback\n * @param {array} filterStatusMap 过滤status\n */\n\n\nfunction catchError(error, statusCallback, filterStatusMap) {\n  if (error.response && error.response.data) {\n    //只有返回json数据的才会走这里，校正为非异常，属于正常后端返回。\n    var status = error.response.status;\n\n    if (filterStatusMap && ~filterStatusMap.indexOf(status)) {\n      status = null;\n    }\n\n    statusCallback && statusCallback(status, error.response.data); //传递http返回码到后端接口返回的数据结构中，通过'__'前缀来区分\n\n    if ((0, _isObject2.default)(error.response.data)) {\n      error.response.data.__status__ = error.response.status; //传递接口是否是正常状态到后端接口返回的数据结构中，通过'__'前缀来区分\n      //这里返回的都是后端接口不正常的数据，后端接口除了200其他都是异常\n\n      error.response.data.__error__ = true;\n    }\n\n    return error.response.data;\n  } else if (error.response) {\n    // The request was made and the server responded with a status code\n    // that falls out of the range of 2xx\n    //console.error(error.response);\n    throw error;\n  } else if (error.request) {\n    //请求超时\n    // The request was made but no response was received\n    // `error.request` is an instance of XMLHttpRequest in the browser and an instance of\n    // http.ClientRequest in node.js\n    //console.error(error.message, error.request);\n    throw error;\n  } else {\n    // Something happened in setting up the request that triggered an Error\n    //console.log(error.message);\n    throw error;\n  }\n}\n/**\n *@param { object } config 跟axios一样，同时自定义了一个filterStatusMap\n *      config.filterStatusMap 如果想在当前请求不走统一处理提示，可以设置filterStatusMap\n *@param { function } statusCallback 状态回调（只要是返回正常的json数据，就会走这里）。\n *    主要提供后续自定义统一返回码提示。\n *    function(status,data){}，status是http状态码，data是后端接口返回的数据（可用是text、json、document等，看设置）\n *@param { function } catchErrorCallback   自定义的异常提示信息，跨域问题、服务器500等非正常返回提示。\n */\n\n\nvar Fetch = exports.Fetch = function () {\n  function Fetch(config, statusCallback, catchErrorCallback) {\n    (0, _classCallCheck3.default)(this, Fetch);\n    this.config = config;\n    this.statusCallback = statusCallback;\n    this.catchErrorCallback = catchErrorCallback;\n  }\n\n  (0, _createClass3.default)(Fetch, [{\n    key: 'setHeaders',\n    value: function setHeaders(callback) {\n      this.headersFunc = callback;\n    } //在使用axios时调用，不要再constructor使用\n\n  }, {\n    key: 'getHeaders',\n    value: function getHeaders() {\n      return this.headersFunc && this.headersFunc();\n    }\n  }, {\n    key: 'getCancelSource',\n    value: function getCancelSource() {\n      var CancelToken = _axios2.default.CancelToken;\n      var source = CancelToken.source();\n      return source;\n    }\n  }, {\n    key: 'request',\n    value: function request(config) {\n      var _this = this;\n\n      if (!this.config.headers) {\n        this.config.headers = {};\n      }\n\n      if (!config.headers) {\n        config.headers = {};\n      }\n\n      var headers = this.getHeaders();\n      config.headers = (0, _extends3.default)({}, this.config.headers, headers, config.headers);\n      config = (0, _extends3.default)({}, this.config, config);\n      config.url = joinUrlParams(config.url, {});\n      return _axios2.default.request(config).then(function (response) {\n        _this.statusCallback && _this.statusCallback(response.status, response.data);\n\n        if (response.data) {\n          if ((0, _isObject2.default)(response.data)) {\n            response.data.__status__ = response.status;\n          }\n        } else {\n          throw new Error('正常返回200的数据格式跟设置的responseType不一致！');\n        }\n\n        return response.data;\n      }).catch(function (error) {\n        //catchError做了一些自定义错误（删除了一些）\n        return catchError(error, _this.statusCallback);\n      }).catch(function (error) {\n        //如果想在当前请求不走统一处理提示，可以设置filterStatusMap\n        _this.catchErrorCallback && _this.catchErrorCallback(error, config.filterStatusMap);\n        throw error;\n      });\n    }\n  }]);\n  return Fetch;\n}();\n/**\n * params json对象(一级)拼接url ?后面的参数\n * @param  {String} url  需要拼接的url\n * @param  {Objct}  params 需要拼接的url json参数\n * @return {String}    拼接的url\n */\n\n\nfunction joinUrlParams(url, params) {\n  var p = '';\n  var i = 0;\n\n  for (var key in params) {\n    var value = params[key];\n\n    if (i === 0 && !~url.indexOf('?')) {\n      p += '?' + key + '=' + value;\n    } else {\n      p += '&' + key + '=' + value;\n    }\n\n    i++;\n  } //random防止IE可能出现的缓存问题\n\n\n  if (key) {\n    p += '&random=' + Math.random() * 100100;\n  } else {\n    if (~url.indexOf('?')) {\n      p += '&random=' + Math.random() * 100100;\n    } else {\n      p += '?random=' + Math.random() * 100100;\n    }\n  }\n\n  return url + p;\n}\n/**\n * 参数参考 Fetch\n * @param { function } setHeaders 返回headers设置\n */","map":{"version":3,"sources":["C:/Users/MaGent/Desktop/video/video/node_modules/html5-player/libs/libs/fetch/index.js"],"names":["Object","defineProperty","exports","value","Fetch","undefined","_extends2","require","_extends3","_interopRequireDefault","_classCallCheck2","_classCallCheck3","_createClass2","_createClass3","joinUrlParams","default","config","statusCallback","catchErrorCallback","setHeaders","ieCache","arguments","length","_config2","fetch","methods","forEach","v","url","data","request","method","_axios","_axios2","_config","_isObject","_isObject2","obj","__esModule","catchError","error","filterStatusMap","response","status","indexOf","__status__","__error__","key","callback","headersFunc","getHeaders","getCancelSource","CancelToken","source","_this","headers","then","Error","catch","params","p","i","Math","random"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Fetch = undefined;\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nexports.joinUrlParams = joinUrlParams;\n\nexports.default = function (config, statusCallback, catchErrorCallback, setHeaders) {\n  var ieCache = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;\n\n  config = (0, _extends3.default)({}, _config2.default, config);\n  var fetch = new Fetch(config, statusCallback, catchErrorCallback);\n  fetch.setHeaders(setHeaders);\n  //这里向外提供get、delete等直接使用的方式。\n  var methods = ['get', 'delete', 'head', 'options', 'post', 'put', 'patch'];\n  methods.forEach(function (v) {\n    switch (v) {\n      case 'post':\n      case 'put':\n      case 'patch':\n        fetch[v] = function (url, data, config) {\n          return fetch.request((0, _extends3.default)({\n            method: v,\n            data: data,\n            url: url\n          }, config));\n        };\n        break;\n      default:\n        fetch[v] = function (url, config) {\n          return fetch.request((0, _extends3.default)({\n            method: v,\n            url: url\n          }, config));\n        };\n    }\n  });\n  return fetch;\n};\n\nvar _axios = require('axios');\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nvar _config = require('./config.js');\n\nvar _config2 = _interopRequireDefault(_config);\n\nvar _isObject = require('lodash/isObject');\n\nvar _isObject2 = _interopRequireDefault(_isObject);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * 处理axios的异常问题，只要能接收到接口数据，都当做是成功请求。\n * 中途出错，无法返回的数据才传递可捕获的异常。\n * @param {error} error\n * @param {object} statusCallback\n * @param {array} filterStatusMap 过滤status\n */\nfunction catchError(error, statusCallback, filterStatusMap) {\n  if (error.response && error.response.data) {\n    //只有返回json数据的才会走这里，校正为非异常，属于正常后端返回。\n    var status = error.response.status;\n    if (filterStatusMap && ~filterStatusMap.indexOf(status)) {\n      status = null;\n    }\n    statusCallback && statusCallback(status, error.response.data);\n    //传递http返回码到后端接口返回的数据结构中，通过'__'前缀来区分\n    if ((0, _isObject2.default)(error.response.data)) {\n      error.response.data.__status__ = error.response.status;\n      //传递接口是否是正常状态到后端接口返回的数据结构中，通过'__'前缀来区分\n      //这里返回的都是后端接口不正常的数据，后端接口除了200其他都是异常\n      error.response.data.__error__ = true;\n    }\n    return error.response.data;\n  } else if (error.response) {\n    // The request was made and the server responded with a status code\n    // that falls out of the range of 2xx\n    //console.error(error.response);\n    throw error;\n  } else if (error.request) {\n    //请求超时\n    // The request was made but no response was received\n    // `error.request` is an instance of XMLHttpRequest in the browser and an instance of\n    // http.ClientRequest in node.js\n    //console.error(error.message, error.request);\n    throw error;\n  } else {\n    // Something happened in setting up the request that triggered an Error\n    //console.log(error.message);\n    throw error;\n  }\n}\n\n/**\n *@param { object } config 跟axios一样，同时自定义了一个filterStatusMap\n *      config.filterStatusMap 如果想在当前请求不走统一处理提示，可以设置filterStatusMap\n *@param { function } statusCallback 状态回调（只要是返回正常的json数据，就会走这里）。\n *    主要提供后续自定义统一返回码提示。\n *    function(status,data){}，status是http状态码，data是后端接口返回的数据（可用是text、json、document等，看设置）\n *@param { function } catchErrorCallback   自定义的异常提示信息，跨域问题、服务器500等非正常返回提示。\n */\n\nvar Fetch = exports.Fetch = function () {\n  function Fetch(config, statusCallback, catchErrorCallback) {\n    (0, _classCallCheck3.default)(this, Fetch);\n\n    this.config = config;\n    this.statusCallback = statusCallback;\n    this.catchErrorCallback = catchErrorCallback;\n  }\n\n  (0, _createClass3.default)(Fetch, [{\n    key: 'setHeaders',\n    value: function setHeaders(callback) {\n      this.headersFunc = callback;\n    }\n\n    //在使用axios时调用，不要再constructor使用\n\n  }, {\n    key: 'getHeaders',\n    value: function getHeaders() {\n      return this.headersFunc && this.headersFunc();\n    }\n  }, {\n    key: 'getCancelSource',\n    value: function getCancelSource() {\n      var CancelToken = _axios2.default.CancelToken;\n      var source = CancelToken.source();\n      return source;\n    }\n  }, {\n    key: 'request',\n    value: function request(config) {\n      var _this = this;\n\n      if (!this.config.headers) {\n        this.config.headers = {};\n      }\n      if (!config.headers) {\n        config.headers = {};\n      }\n      var headers = this.getHeaders();\n      config.headers = (0, _extends3.default)({}, this.config.headers, headers, config.headers);\n      config = (0, _extends3.default)({}, this.config, config);\n\n      config.url = joinUrlParams(config.url, {});\n      return _axios2.default.request(config).then(function (response) {\n        _this.statusCallback && _this.statusCallback(response.status, response.data);\n        if (response.data) {\n          if ((0, _isObject2.default)(response.data)) {\n            response.data.__status__ = response.status;\n          }\n        } else {\n          throw new Error('正常返回200的数据格式跟设置的responseType不一致！');\n        }\n        return response.data;\n      }).catch(function (error) {\n        //catchError做了一些自定义错误（删除了一些）\n        return catchError(error, _this.statusCallback);\n      }).catch(function (error) {\n        //如果想在当前请求不走统一处理提示，可以设置filterStatusMap\n        _this.catchErrorCallback && _this.catchErrorCallback(error, config.filterStatusMap);\n        throw error;\n      });\n    }\n  }]);\n  return Fetch;\n}();\n\n/**\n * params json对象(一级)拼接url ?后面的参数\n * @param  {String} url  需要拼接的url\n * @param  {Objct}  params 需要拼接的url json参数\n * @return {String}    拼接的url\n */\n\n\nfunction joinUrlParams(url, params) {\n  var p = '';\n  var i = 0;\n  for (var key in params) {\n    var value = params[key];\n    if (i === 0 && !~url.indexOf('?')) {\n      p += '?' + key + '=' + value;\n    } else {\n      p += '&' + key + '=' + value;\n    }\n    i++;\n  }\n  //random防止IE可能出现的缓存问题\n  if (key) {\n    p += '&random=' + Math.random() * 100100;\n  } else {\n    if (~url.indexOf('?')) {\n      p += '&random=' + Math.random() * 100100;\n    } else {\n      p += '?random=' + Math.random() * 100100;\n    }\n  }\n  return url + p;\n}\n/**\n * 参数参考 Fetch\n * @param { function } setHeaders 返回headers设置\n */"]},"metadata":{},"sourceType":"script"}